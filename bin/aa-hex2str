#!/bin/sh
#
# Author: Jamie Strandboge <jamie@ubuntu.com>
# Copyright (C) 2009 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 3 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.
#
# Script to decode the hex-encoded string like from syslog:
# Aug 18 23:56:11 corona kernel: [14335.422844] type=1503 audit(1250636171.706:27): operation="mknod" info="Failed name lookup - deleted entry" error=-2 pid=7731 parent=4075 profile="/usr/bin/evince" requested_mask="w::" denied_mask="w::" fsuid=1000 ouid=1000 name=2F686F6D652F74776967617468792F2E726563656E746C792D757365642E7862656C2E444555495955202864656C6574656429
#
# Eg:
# $ aa-hex2str 2F686F6D652F74776967617468792F2E726563656E746C792D757365642E7862656C2E444555495955202864656C6574656429
# Encoded: 2F686F6D652F74776967617468792F2E726563656E746C792D757365642E7862656C2E444555495955202864656C6574656429
# Decoded: /home/twigathy/.recently-used.xbel.DEUIYU (deleted)

set -e

help() {
    echo "USAGE: aa-hex2str <ENCODED STRING>"
}

if [ -z "$1" ]; then
    help
    exit 1
fi
encoded="$1"

if ! echo "$encoded" | egrep "^[0-9a-fA-F]+$" ; then
    echo "String should only contain hex characters (0-9, a-f, A-G)"
    exit 1
fi

len=`echo "$encoded" | wc -m`
newstr=""
index=1
while /bin/true; do
    tmp=`echo "$encoded" | cut -b $index-$((index+1))`
    if [ -z "$tmp" ]; then
        break
    fi
    tmpc=`echo "$tmp" | tr -s '[:lower:]' '[:upper:]' | sed 's/^/ibase=16;print /g' | bc | awk '{printf("%c", $0);}'`
    newstr="$newstr$tmpc"
    index=$((index+2))
done
echo "Encoded: $encoded"
echo "Decoded: $newstr"
